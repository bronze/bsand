{# https://alpinetoolbox.com/examples/navbar #}
{# https://stackblitz.com/edit/alpine-js-scroll-detection-with-sticky-nav?file=index.html #}
{# https://laracasts.com/discuss/channels/guides/multiple-issues-with-building-a-responsive-sticky-navbar-using-tailwind-and-alpinejs #}
{# https://www.youtube.com/watch?v=vafc43cIUz8 #}
<a id="primary_nav"></a>
<header class="fixed header-nav py-4 lg:py-0 lg:h-[125px] bg-muted lg:bg-transparent  ease-in-out top-0 left-0 z-50 w-full font-lg text-text font-nav uppercase shadow lg:shadow-none pointer-events-none"
x-data="{navOpen: false, scrolledFromTop: false}"
x-init="window.pageYOffset >= 50 ? scrolledFromTop = true : scrolledFromTop = false"
x-on:scroll.window.throttle="window.pageYOffset >= 50 ? scrolledFromTop = true : scrolledFromTop = false"
>
  <nav id="navbar"  role="navigation" aria-label="Main"
  x-bind:class="{'lg:h-[100px]': !scrolledFromTop, 'lg:h-[80px] lg:shadow': scrolledFromTop}"
    class="z-20 relative lg:h-[100px] pointer-events-auto flex w-full px-1 transition-[height,box-shadow] duration-300 ease-in place-items-center bg-muted lg:py-0 lg:relative sm:px-2 md:px-0">
    <div class="container mx-auto inline-flex h-full w-full max-w-7xl flex-wrap place-items-center justify-between text-xl md:text-2xl xl:text-4xl" @click.away="navOpen = false" >
      <div class="relative inline-flex h-full flex-shrink items-center pl-2 xl:pl-0 group">
        <div class="lg:drop-shadow-[0_4px_2px_rgba(0,0,0,0.6)] lg:group-hover:drop-shadow-[0_4px_2px_rgba(0,0,0,0.8)] flag-wrap z-50">
          <div class="flag lg:h-[125px] lg:w-[55px] -top-1 lg:top-[12px] relative">
            <svg class="w-8 h-8 right-full fill-text group-hover:drop-shadow-[0_1px_2px_rgba(0,0,0,1)] lg:fill-white lg:w-12 lg:h-12 xl:w-16 xl:h-16 relative left-0 lg:top-[-12px]" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" viewBox="0 0 271 505">
              <path d="M267.308 295.192c3.231-15.846 4.077-37.308 2-50.693-3.154-19.615-11.385-36.153-23.615-47.615-3.231-3-6.154-5.461-6.539-5.461-.384 0 .154 1.692 1.231 3.846 4.308 8.461 6.538 17.154 6.538 25.154 0 2.23-.153 4.076-.23 4.076-.154 0-3-2.615-6.385-5.846l-6.077-5.769-.385 6c-.615 8.385-1.076 8.846-4.769 4.769-14.461-16.154-31.692-43.923-58.308-94.154-2.23-4.23-7-13.076-10.615-19.615-3.615-6.538-7.077-13.846-7.615-16.154-.616-2.307-1.231-9.923-1.462-16.923l-.384-12.692-6.308-6.385c-12.616-12.846-33.154-30-35.077-29.231-.308.077 1.615 3.539 4.308 7.539 9.077 13.538 18 29 20 34.692 1.538 4.308 2.077 7.693 2.384 14 .154 4.616.077 8.616-.307 9-.924.923-11.616-8.231-16.616-14-9.308-10.923-17.384-25.461-22.154-40l-2.461-7.538-8.616-5.693C70.769 16.422 43.231 1.961 35.769.192c-2.153-.539-2.076-.231 2.539 4.769 21.461 23.692 34.461 42.154 44.385 63 5.307 11.077 7.23 16.308 9.538 25.385 1.692 6.769 3.308 18 2.615 19.077-.23.307-1.153.076-2.153-.539s-8.77-5.231-17.385-10.154c-15.231-8.769-22.077-12.307-22.692-11.692-.154.154 2.538 3.615 5.923 7.615 3.461 4 8.077 9.693 10.384 12.77 7 9.307 12.462 20.846 10.462 22.076-.769.462-7.539-1.769-17.385-5.692-3.231-1.231-6.154-2.308-6.384-2.308-1.077 0 9.615 10.308 17.077 16.539 8.076 6.692 24.769 18.846 25.846 18.846 1.307 0 2.077 3 2.923 11.154 1.615 15.769 5.307 29.923 10.923 41.769 2.538 5.308 3.308 6.308 4.846 6.308 4.231 0 19.846 3.154 26.615 5.384 15.077 5 31.77 14.077 47.154 25.616 11.231 8.461 28.539 25.308 35.154 34.384 2.616 3.616 4.846 6.616 5 6.77.077.154 2.385-3.231 5.077-7.462 2.692-4.308 5.154-7.769 5.385-7.769 1.077 0 13.846 12.692 18.769 18.692 2.923 3.616 5.461 6.462 5.538 6.385.154-.077.77-2.769 1.385-5.923Zm-96.923-105c-10.154-2.308-9.923-2.231-13.385-8-1.769-2.923-5.769-8.693-9-12.769-3.154-4.077-5.615-7.616-5.384-7.847.538-.538 9.538 5.462 15.538 10.308 7.462 6.077 20.231 18.231 19.846 18.923-.538.846-2.077.692-7.615-.615Z" class="head"/>
              <path d="M209.539 434.884c24.923-27.923 40.461-48 49.923-64.615 5.538-9.616 6.154-12.077 5.769-20.769-.692-12-6.231-22.77-18.154-35.154-8-8.308-15.538-14.308-29-23.077-24.384-15.846-49.384-29.923-85-47.923-27.692-13.923-28.769-14.693-33.308-23.847-5.692-11.384-11.307-34.923-11.307-47.384v-3.616l-5.154-3.076c-5.923-3.539-13.692-9.077-19.077-13.616l-3.692-3.077-5.385 5.769C33.462 177.807 21 194.038 13.616 208.73c-3.847 7.693-5.923 14-5.923 17.846 0 10 14.769 27.77 36.769 44.308 28.846 21.692 80.384 53.154 133.384 81.462l14.462 7.692v93.231l2.769-2.693c1.539-1.384 8-8.461 14.462-15.692Z" class="body"/>
              <path d="m160.539 485.884 17.923-17.923v-50l.077-50L161 358.192c-9.615-5.385-17.846-9.846-18.307-9.846-.539 0-.77 26.384-.77 77.692 0 42.769.154 77.692.385 77.692s8.461-8.077 18.231-17.846Z" class="section-right"/>
              <path d="m128.308 421.653-.231-82-17.692-10.615c-9.692-5.846-17.923-10.615-18.231-10.692-.385 0-.615 33.461-.615 74.461v74.385l17.769 18.308c9.769 10 18.077 18.23 18.461 18.23.385 0 .616-32.461.539-82.077Z" class="section-left"/>
              <path d="M77.693 413.423v-38.77l-5.154-2.461C58.462 365.653 42 354.961 29.462 344.269c-9.308-8-16.539-15.77-24.231-26L0 311.346v12.538c0 13.462 1.308 23.692 3.923 31.616 5.154 15.538 22.923 41.076 48.616 70.153 7.692 8.693 24.384 26.539 24.846 26.539.154 0 .308-17.462.308-38.769Z" class="tail"/>
            </svg>
          </div>
        </div>
        <a href="/" class="logo" aria-label="Go to homepage">
          <svg class="max-w-[300px] h-6 transition duration-300 xl:h-16 fill-text hover:fill-primary " xmlns="http://www.w3.org/2000/svg" xml:space="preserve" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2" clip-rule="evenodd" viewBox="0 0 439 43">
            <path fill-rule="nonzero" d="M.002 42.812h18.483c3.108 0 5.304-2.357 5.304-5.358v-13.29l-3.537-3.05c1.659-.806 3.537-2.304 3.537-5.895V5.354c0-3.426-2.518-5.246-5.411-5.246H.002v42.704ZM8.62 34.94v-8.904h6.762v8.904H8.62Zm0-16.775V7.98h6.762v10.187H8.62ZM27.277 0v42.812h8.676V27.593h1.552l5.313 15.219h8.89l-5.621-16.024c2.25-.268 4.924-2.303 4.924-5.836V5.354c0-3.426-2.41-5.246-5.246-5.246C38.417.108 27.277 0 27.277 0ZM35.9 19.24V7.978h6.65v11.26H35.9Zm17.15 23.572h8.895l.805-5.698h9.056l.966 5.698h9.056L74.378.108H60.93l-7.88 42.704Zm11.042-12.59 3-18.706h.64l2.898 18.707h-6.538Zm19.185 12.59h8.622v-23.76l6.489 14.185v9.575h8.68V.108h-8.68v14.288L91.899.27V.108h-8.622v42.704Zm27.28 0h18.487c3.104 0 5.353-2.357 5.353-5.358V5.461a5.336 5.336 0 0 0-5.353-5.353L110.557 0v42.81Zm8.89-7.871V7.979h6.596V34.94h-6.596Zm23.796 7.871h12.915c2.997 0 5.354-2.357 5.354-5.358V5.461c0-2.996-2.357-5.353-5.354-5.353h-12.915a5.337 5.337 0 0 0-5.357 5.353v31.993a5.338 5.338 0 0 0 5.357 5.358Zm3.318-7.871V7.979h6.597l.053 26.962h-6.65Zm18.443 7.871h8.622v-23.76l6.485 14.185v9.575h8.68V.108h-8.68v14.288L173.626.27V.108h-8.622v42.704ZM211.782.108c-5.143 0-5.411 3.801-5.411 8.032v12.732c0 2.889 1.927 5.08 4.66 5.08h7.718l-.053 9.096h-9.808l-2.84 7.817h15.487c4.611 0 5.68-3.532 5.68-6.48V23.331c0-4.011-1.874-5.134-4.553-5.134h-7.665V7.817h9.647l3.161-7.71h-16.023Zm16.828 42.704h8.895l.805-5.698h9.056l.966 5.698h9.056L249.938.108h-13.452l-7.876 42.704Zm11.037-12.59 3.001-18.706h.644l2.894 18.707h-6.539Zm19.19 12.59h8.622v-23.76l6.49 14.185v9.575h8.675V.108h-8.676v14.288L267.46.27V.108h-8.622v42.704Zm27.28 0H304.6c3.108 0 5.358-2.357 5.358-5.358V5.461A5.337 5.337 0 0 0 304.6.108L286.117 0v42.81Zm8.886-7.871V7.979h6.596V34.94h-6.596Zm18.443 7.871h17.785l2.894-7.871h-12.057v-9.816h7.017l2.898-7.871h-9.915V7.979h9.163l2.894-7.871L313.445 0v42.81ZM336.008 0v42.812h8.675V27.593h1.552l5.313 15.219h8.89l-5.625-16.024c2.25-.268 4.928-2.303 4.928-5.836V5.354c0-3.426-2.41-5.246-5.246-5.246-7.347 0-18.487-.107-18.487-.107Zm8.622 19.24V7.978h6.65v11.26h-6.65ZM369.123.108c-5.147 0-5.415 3.801-5.415 8.032v12.732c0 2.889 1.932 5.08 4.664 5.08h7.714l-.053 9.096h-9.803l-2.844 7.817h15.491c4.606 0 5.68-3.532 5.68-6.48V23.331c0-4.011-1.879-5.134-4.557-5.134h-7.661V7.817h9.646l3.162-7.71h-16.024Zm24.329 42.704h12.915c3 0 5.353-2.357 5.353-5.358V5.461c0-2.996-2.352-5.353-5.353-5.353h-12.915a5.337 5.337 0 0 0-5.358 5.353v31.993a5.338 5.338 0 0 0 5.358 5.358Zm3.318-7.871V7.979h6.6l.054 26.962h-6.654Zm18.443 7.871h8.622v-23.76l6.489 14.185v9.575H439V.108h-8.676v14.288L423.834.27V.108h-8.621v42.704Z"/>
          </svg>
        </a>
      </div>
      <div class="flex pr-4 ">
         <button aria-label="Open the menu" class="flex justify-between px-2 py-4 lg:hidden" @click="navOpen = !navOpen"  x-bind:class="{ 'transition transition-180': navOpen }">
          <svg aria-hidden="true"
            class="h-6 w-6 fill-current"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24">
              <path
                x-show="navOpen"
                fill-rule="evenodd"
                clip-rule="evenodd"
                d="M18.278 16.864a1 1 0 0 1-1.414 1.414l-4.829-4.828-4.828 4.828a1 1 0 0 1-1.414-1.414l4.828-4.829-4.828-4.828a1 1 0 0 1 1.414-1.414l4.829 4.828 4.828-4.828a1 1 0 1 1 1.414 1.414l-4.828 4.829 4.828 4.828z"
              />
              <path
                x-show="!navOpen"
                fill-rule="evenodd"
                d="M4 5h16a1 1 0 0 1 0 2H4a1 1 0 1 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2zm0 6h16a1 1 0 0 1 0 2H4a1 1 0 0 1 0-2z"
              />
          </svg>
        </button>
      </div>
      <div class="w-full lg:visible bg-inherit lg:bg-transparent lg:flex lg:grow lg:place-content-end lg:w-auto" id="menu"
                 x-bind:class="{ 'block shadow-3xl': navOpen, 'hidden': !navOpen }"
        x-show.transition="true">
        <!-- {{ collections.all | eleventyNavigation | eleventyNavigationToHtml | safe }} -->

        {% set navPages = collections.all | eleventyNavigation %}
        <ul class="pl-6 lg:pl-0 pt-4 text-base lg:flex lg:grow lg:max-w-[95%] xl:max-w-[90%] lg:justify-between lg:pt-0">
          {%- for entry in navPages %}
            <li {% if entry.url == page.url or (entry.url == page.url | getbase) %} aria-current="page" class="active"{% endif %}>
              <a class="block py-2 linknav lg:pt-4 lg:p-2 xl:p-4"  href="{{ entry.url }}">{{ entry.title }}</a>
            </li>
          {%- endfor %}
          <li class="hidden items-center py-2 lg:flex lg:p-4" x-data="{ shiftPressed: false }">
            <button  class="cursor-pointer"
              title="Dark Mode Toggle"
              x-on:click="toggleTheme()"
              rel="nofollow">
               <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M7.5 2c-1.79 1.15-3 3.18-3 5.5s1.21 4.35 3.03 5.5C4.46 13 2 10.54 2 7.5A5.5 5.5 0 0 1 7.5 2m11.57 1.5l1.43 1.43L4.93 20.5L3.5 19.07L19.07 3.5m-6.18 2.43L11.41 5L9.97 6l.42-1.7L9 3.24l1.75-.12l.58-1.65L12 3.1l1.73.03l-1.35 1.13l.51 1.67m-3.3 3.61l-1.16-.73l-1.12.78l.34-1.32l-1.09-.83l1.36-.09l.45-1.29l.51 1.27l1.36.03l-1.05.87l.4 1.31M19 13.5a5.5 5.5 0 0 1-5.5 5.5c-1.22 0-2.35-.4-3.26-1.07l7.69-7.69c.67.91 1.07 2.04 1.07 3.26m-4.4 6.58l2.77-1.15l-.24 3.35l-2.53-2.2m4.33-2.7l1.15-2.77l2.2 2.54l-3.35.23m1.15-4.96l-1.14-2.78l3.34.24l-2.2 2.54M9.63 18.93l2.77 1.15l-2.53 2.19l-.24-3.34Z"/></svg>
            </button>
          </li>
          <li class="flex items-center">
            <a id="search-toggle" title="Search" class="inline-flex cursor-pointer items-center py-2 lg:p-2 search-icon">
              <span class="block pr-4 lg:hidden lg:pr-0">Search </span>
              <svg class="pointer-events-none inline h-4 w-4 fill-current text-grey-darkest" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                <path d="M12.9 14.32a8 8 0 1 1 1.41-1.41l5.35 5.33-1.42 1.42-5.33-5.34zM8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12z"></path>
              </svg>
            </a>
          </li>
        </ul>

      </div>
    </div>
  <div class="pointer-events-auto absolute top-full z-10 hidden w-full shadow-xl bg-muted" id="search-content">
    <div class="container mx-auto px-2 py-4 lg:mt-6">
      <input id="searchfield" type="search" placeholder="Search..." autofocus="autofocus" class="mx-auto w-full appearance-none p-2 text-xl leading-normal header-search text-grey-800 focus:outline-none focus:border-transparent lg:text-2xl">
    </div>
  </div>
  </nav>

</header>
<div class="mt-28"></div>

<script>

// Stolen from https://codepen.io/jwssnr/pen/MWVRzap
// Which is a downstripped version of https://codepen.io/skttl/pen/oNXLObp

  /*Toggle dropdown list*/
  /*https://gist.github.com/slavapas/593e8e50cf4cc16ac972afcbad4f70c8*/

  var searchMenuDiv = document.getElementById("search-content");
  var searchMenu = document.getElementById("search-toggle");

  document.onclick = check;

  function check(e) {
      var target = (e && e.target) || (event && event.srcElement);

      //User Menu
      if (!checkParent(target, searchMenuDiv)) {
          // click NOT on the menu
          if (checkParent(target, searchMenu)) {
              // click on the link
              if (searchMenuDiv.classList.contains("hidden")) {
                  searchMenuDiv.classList.remove("hidden");
                  searchfield.focus();
              } else {
                  searchMenuDiv.classList.add("hidden");
              }
          } else {
              // click both outside link and outside menu, hide menu
              searchMenuDiv.classList.add("hidden");
          }
      }
  }

  function checkParent(t, elm) {
      while (t.parentNode) {
          if (t == elm) {
              return true;
          }
          t = t.parentNode;
      }
      return false;
  }

</script>

<style lang="sass">
  .flag {
    display: flex;
    place-content: center;
    place-items: center;
  }
  @media (min-width: 1024px) {
    .flag {
      background-color: #80001D;
      clip-path: polygon(100% 0, 100% 80%, 50% 100%, 0 80%, 0 0);
      display: flex;
      place-content: center;
      place-items: center;
      margin-right: 1rem;
      @apply drop-shadow-lg;
      svg {
        width: 50%;
      }
    }
  }

</style>

<style>
#menu ul {
  li:last-of-type {
    @apply pr-0;
  }
}
</style>